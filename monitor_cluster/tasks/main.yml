---
# tasks file for monitor_cluster
- name: Wait for 60 min until the cluster is installed
  sonofspike.ocm.rest_api_call:
    url: "{{ URL_ASSISTED_INSTALLER_CLUSTER }}"
    method: "GET"
    query: None
    data: {}
    access_token: "{{ access_token }}"
    api_token: "{{ api_token }}"
  register: response
  until: response.json.status in ['installed', 'error', 'cancelled']
  retries: 60
  delay: 60
  delegate_to: bastion

- name: "Fail installation because user cancelled (ERROR)"
  fail:
    msg: "Cluster installation failed - Reset the installation process to return to the configuration and try again"
  when: cluster.json.status == 'error'
  delegate_to: bastion

- name: "Fail installation because user cancelled (CANCELLED)"
  fail:
    msg: "Installation was canceled by user - Reset the installation process to return to the configuration and try again"
  when: cluster.json.status == 'cancelled'
  delegate_to: bastion
